#!/bin/bash

# Path to the project directory (where this script originates)
PROJECT_DIR="TODO: Add the path to the project directory here"

# Check if URL was provided
if [ $# -eq 0 ]; then
    echo "Usage: slack-summarizer <slack_permalink>"
    echo 'Example: slack-summarizer "https://redhat-internal.slack.com/archives/CB95J6R4N/p1764683404081219"'
    exit 1
fi

# Check if project directory exists
if [ ! -d "$PROJECT_DIR" ]; then
    echo "Error: Project directory not found at $PROJECT_DIR"
    exit 1
fi

# Check if virtual environment exists
if [ ! -f "$PROJECT_DIR/.venv/bin/activate" ]; then
    echo "Error: Virtual environment not found at $PROJECT_DIR/.venv"
    echo "Please create it with: python3 -m venv .venv && .venv/bin/pip install -r requirements.txt"
    exit 1
fi

# Check if environment variables are set
if [ -z "$SLACK_TOKEN" ] || [ -z "$USER_TOKEN" ]; then
    echo "Error: SLACK_TOKEN and USER_TOKEN environment variables must be set"
    echo "Make sure your shell setup sources them properly"
    exit 1
fi

# Source the virtual environment and run the script
cd "$PROJECT_DIR"
source .venv/bin/activate
python fetch_conversation.py "$@"